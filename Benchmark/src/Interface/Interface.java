/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Interface;

import Benchmark.ByteConverter;
import Benchmark.Computation;
import Benchmark.ReadingObject;
import Benchmark.WritingObject;
import java.io.File;
import java.util.ArrayList;
import java.util.Random;
import javax.swing.JOptionPane;

/**
 * Classe responsável por gerenciar a aplicação do programa, assim como
 * estabelecer uma interface entre o usuário e o software.
 * 
 * @author prestes
 */
public class Interface extends javax.swing.JFrame 
{   
    private ByteConverter byteConverter;
    private ArrayList<Double> throughputs;
    private Computation computation;
    
    /**
     * Método construtor.
     */
    public Interface() 
    {   
        byteConverter = new ByteConverter();
        throughputs = new ArrayList<>();
        computation = new Computation();
        
        initComponents();
        
        buttonGroup1.add(jRadioButton11);
        buttonGroup1.add(jRadioButton12);
        
        buttonGroup2.add(jRadioButton13);
        buttonGroup2.add(jRadioButton14);
        
        buttonGroup3.add(jRadioButton1);
        buttonGroup3.add(jRadioButton2);
        buttonGroup3.add(jRadioButton3);
        buttonGroup3.add(jRadioButton4);
        buttonGroup3.add(jRadioButton5);
        buttonGroup3.add(jRadioButton6);
        buttonGroup3.add(jRadioButton7);
        
        buttonGroup4.add(jRadioButton8);
        buttonGroup4.add(jRadioButton9);
        buttonGroup4.add(jRadioButton10);
        
        this.setVisible(true);     
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        buttonGroup2 = new javax.swing.ButtonGroup();
        buttonGroup3 = new javax.swing.ButtonGroup();
        buttonGroup4 = new javax.swing.ButtonGroup();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        jLabel2 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jRadioButton11 = new javax.swing.JRadioButton();
        jRadioButton12 = new javax.swing.JRadioButton();
        jPanel2 = new javax.swing.JPanel();
        jRadioButton13 = new javax.swing.JRadioButton();
        jRadioButton14 = new javax.swing.JRadioButton();
        jPanel3 = new javax.swing.JPanel();
        jRadioButton2 = new javax.swing.JRadioButton();
        jRadioButton1 = new javax.swing.JRadioButton();
        jRadioButton3 = new javax.swing.JRadioButton();
        jRadioButton4 = new javax.swing.JRadioButton();
        jRadioButton5 = new javax.swing.JRadioButton();
        jRadioButton6 = new javax.swing.JRadioButton();
        jRadioButton7 = new javax.swing.JRadioButton();
        jPanel4 = new javax.swing.JPanel();
        jRadioButton8 = new javax.swing.JRadioButton();
        jRadioButton9 = new javax.swing.JRadioButton();
        jRadioButton10 = new javax.swing.JRadioButton();
        jTextField1 = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jTextField2 = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Trabalho 2 SO - Benchmark");
        setMinimumSize(new java.awt.Dimension(689, 433));
        setResizable(false);
        getContentPane().setLayout(null);

        jTextArea1.setEditable(false);
        jTextArea1.setColumns(20);
        jTextArea1.setRows(5);
        jScrollPane1.setViewportView(jTextArea1);

        getContentPane().add(jScrollPane1);
        jScrollPane1.setBounds(30, 150, 360, 170);

        jLabel2.setBackground(java.awt.Color.black);
        jLabel2.setFont(new java.awt.Font("Ubuntu", 1, 30)); // NOI18N
        jLabel2.setForeground(javax.swing.UIManager.getDefaults().getColor("Button.background"));
        jLabel2.setText("Log:");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(30, 100, 70, 36);

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Imagens/Title.png"))); // NOI18N
        getContentPane().add(jLabel1);
        jLabel1.setBounds(10, 20, 390, 70);

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Operation:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 1, 14))); // NOI18N
        jPanel1.setLayout(null);

        jRadioButton11.setText("Write");
        jPanel1.add(jRadioButton11);
        jRadioButton11.setBounds(10, 30, 90, 24);

        jRadioButton12.setText("Read");
        jPanel1.add(jRadioButton12);
        jRadioButton12.setBounds(170, 30, 70, 24);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(410, 30, 250, 70);

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Type", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 1, 14))); // NOI18N
        jPanel2.setLayout(null);

        jRadioButton13.setText("Random");
        jPanel2.add(jRadioButton13);
        jRadioButton13.setBounds(10, 30, 90, 24);

        jRadioButton14.setText("Sequential");
        jPanel2.add(jRadioButton14);
        jRadioButton14.setBounds(130, 30, 130, 24);

        getContentPane().add(jPanel2);
        jPanel2.setBounds(410, 110, 250, 70);

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Pack Size (KB):", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 1, 14))); // NOI18N
        jPanel3.setLayout(null);

        jRadioButton2.setText("2");
        jPanel3.add(jRadioButton2);
        jRadioButton2.setBounds(70, 30, 40, 24);

        jRadioButton1.setText("1");
        jPanel3.add(jRadioButton1);
        jRadioButton1.setBounds(20, 30, 40, 24);

        jRadioButton3.setText("4");
        jPanel3.add(jRadioButton3);
        jRadioButton3.setBounds(130, 30, 40, 24);

        jRadioButton4.setText("8");
        jPanel3.add(jRadioButton4);
        jRadioButton4.setBounds(190, 30, 40, 24);

        jRadioButton5.setText("16");
        jPanel3.add(jRadioButton5);
        jRadioButton5.setBounds(20, 70, 50, 24);

        jRadioButton6.setText("32");
        jPanel3.add(jRadioButton6);
        jRadioButton6.setBounds(70, 70, 50, 24);

        jRadioButton7.setText("64");
        jPanel3.add(jRadioButton7);
        jRadioButton7.setBounds(130, 70, 50, 24);

        getContentPane().add(jPanel3);
        jPanel3.setBounds(410, 190, 250, 110);

        jPanel4.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "File Size:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Dialog", 1, 14))); // NOI18N
        jPanel4.setLayout(null);

        jRadioButton8.setText("MB");
        jPanel4.add(jRadioButton8);
        jRadioButton8.setBounds(100, 60, 60, 24);

        jRadioButton9.setText("KB");
        jPanel4.add(jRadioButton9);
        jRadioButton9.setBounds(10, 60, 50, 24);

        jRadioButton10.setText("GB");
        jPanel4.add(jRadioButton10);
        jRadioButton10.setBounds(180, 60, 60, 24);
        jPanel4.add(jTextField1);
        jTextField1.setBounds(50, 20, 60, 30);

        jLabel4.setText("Size:");
        jPanel4.add(jLabel4);
        jLabel4.setBounds(10, 30, 49, 17);

        jLabel5.setText("Times:");
        jPanel4.add(jLabel5);
        jLabel5.setBounds(130, 30, 49, 17);
        jPanel4.add(jTextField2);
        jTextField2.setBounds(180, 20, 60, 30);

        getContentPane().add(jPanel4);
        jPanel4.setBounds(410, 310, 250, 100);

        jButton1.setText("Start");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        getContentPane().add(jButton1);
        jButton1.setBounds(40, 340, 350, 60);

        jLabel3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Imagens/Background.jpg"))); // NOI18N
        jLabel3.setMaximumSize(new java.awt.Dimension(953, 560));
        jLabel3.setMinimumSize(new java.awt.Dimension(953, 560));
        jLabel3.setPreferredSize(new java.awt.Dimension(953, 560));
        getContentPane().add(jLabel3);
        jLabel3.setBounds(0, 0, 700, 450);

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents
    
    /**
     * Método responsável por verificar o tamanho do bloco selecionado.
     * 
     * @return long - Corresponde ao tamanho do bloco.
     */
    private long packSizeCheck()
    {
        if (jRadioButton1.isSelected())
            return 1;
        else
            if (jRadioButton2.isSelected())
                return 2;
            else
                if (jRadioButton3.isSelected())
                    return 4;
                else
                    if (jRadioButton4.isSelected())
                        return 8;
                    else
                        if (jRadioButton5.isSelected())
                            return 16;
                        else
                            if (jRadioButton6.isSelected())
                                return 32;
                            else
                                return 64;
    }
    
    /**
     * Método responsável por realizar o teste no benchmark desenvolvido.
     * 
     * @param evt java.awt.event.ActionEvent - Corresponde ao clique do mouse.
     */
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        
        int times = 0;
        double executionTime = 0;
        long packSize, fileSize = 0;
        boolean flagError;
        Random randomGeneration = new Random();
        
        if (buttonGroup1.isSelected(null) || buttonGroup2.isSelected(null) || buttonGroup3.isSelected(null) || buttonGroup4.isSelected(null) || jTextField1.getText().equals("") || jTextField2.getText().equals(""))
            JOptionPane.showMessageDialog(null, "Por favor, verifique as operações!", "Error", JOptionPane.ERROR_MESSAGE);
        else
        {   flagError = false;
            try
            {   fileSize = Integer.parseInt(jTextField1.getText());
                times = Integer.parseInt(jTextField2.getText());
            }
            catch (Exception e)
            {   JOptionPane.showMessageDialog(null, "Por favor, digite valores válidos!", "Error", JOptionPane.ERROR_MESSAGE);
                flagError = true;
            }
            
            if (!flagError)
            {   
                packSize = packSizeCheck();
                packSize = byteConverter.converterKB(packSize);
            
                if (jRadioButton9.isSelected())
                    fileSize = byteConverter.converterKB(fileSize);
                else
                    if (jRadioButton8.isSelected())
                        fileSize = byteConverter.converterMB(fileSize);
                    else
                        fileSize = byteConverter.converterGB(fileSize);
                
                throughputs.clear();
                
                if (jRadioButton11.isSelected())
                {   if (jRadioButton13.isSelected())
                        for (int i=0; i<times; i++)
                        {   computation.startTime();
                            WritingObject writeObj = new WritingObject("Random_Write"+randomGeneration.nextInt()+".txt", (int) packSize, fileSize);
                            writeObj.randomWrite(0);
                            executionTime = executionTime + computation.endTime();
                            throughputs.add(computation.throughput(fileSize));
                        }
                    else
                        for (int i=0; i<times; i++)
                        {   computation.startTime();
                            WritingObject writeObj = new WritingObject("Sequential_Write"+randomGeneration.nextInt()+".txt", (int) packSize, fileSize);
                            writeObj.sequentialWrite(true);
                            executionTime = executionTime + computation.endTime();
                            throughputs.add(computation.throughput(fileSize));
                        }
                }
                else
                {   int initial = 0, end = 4, c = 0;
                    if (jRadioButton13.isSelected())
                        for (int i=0; i<times; i++)
                        {   if (i == 0 || c == 3)
                            {   for (int j=initial; j<end; j++)
                                {   WritingObject writeObj = new WritingObject("Read_File"+j+".txt", (int) packSize, fileSize);
                                    writeObj.sequentialWrite(false);    
                                }
                                if (i == 0)
                                    c = 0;
                                else
                                    c = -1;
                                initial += 4;
                                end += 4;
                            }
                        
                            computation.startTime();
                            ReadingObject readObj = new ReadingObject("Read_File"+i+".txt", (int) packSize);
                            readObj.randomRead(0);
                            executionTime = executionTime + computation.endTime();
                            throughputs.add(computation.throughput(fileSize));
                            c++;
                        }
                    else
                        for (int i=0; i<times; i++)
                        {   if (i == 0 || c == 3)
                            {   for (int j=initial; j<end; j++)
                                {   WritingObject writeObj = new WritingObject("Read_File"+j+".txt", (int) packSize, fileSize);
                                    writeObj.sequentialWrite(false);    
                                }
                                if (i == 0)
                                    c = 0;
                                else
                                    c = -1;
                                initial += 4;
                                end += 4;
                            }
                            
                            computation.startTime();
                            ReadingObject readObj = new ReadingObject("Read_File"+i+".txt", (int) packSize);
                            readObj.sequentialRead();
                            executionTime = executionTime + computation.endTime();
                            throughputs.add(computation.throughput(fileSize));
                            c++;
                        }
                    
                    for (int i=0; i<times+4; i++)
                    {   File file = new File ("Read_File"+i+".txt");
                        if (file.exists())
                            file.delete();
                    }
                }
                
                jTextArea1.setText("Throughputs calculados para "+times+" arquivos:\n\n");
                jTextArea1.append("Média: "+computation.average(throughputs)+" MB/s\n");
                jTextArea1.append("Desvio padrão: "+computation.standartDeviation(throughputs)+" MB/s\n");
                jTextArea1.append("Tempo de execução: "+executionTime+" s");                
            }
        }
    }//GEN-LAST:event_jButton1ActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.ButtonGroup buttonGroup2;
    private javax.swing.ButtonGroup buttonGroup3;
    private javax.swing.ButtonGroup buttonGroup4;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JRadioButton jRadioButton1;
    private javax.swing.JRadioButton jRadioButton10;
    private javax.swing.JRadioButton jRadioButton11;
    private javax.swing.JRadioButton jRadioButton12;
    private javax.swing.JRadioButton jRadioButton13;
    private javax.swing.JRadioButton jRadioButton14;
    private javax.swing.JRadioButton jRadioButton2;
    private javax.swing.JRadioButton jRadioButton3;
    private javax.swing.JRadioButton jRadioButton4;
    private javax.swing.JRadioButton jRadioButton5;
    private javax.swing.JRadioButton jRadioButton6;
    private javax.swing.JRadioButton jRadioButton7;
    private javax.swing.JRadioButton jRadioButton8;
    private javax.swing.JRadioButton jRadioButton9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextArea1;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField2;
    // End of variables declaration//GEN-END:variables

}
